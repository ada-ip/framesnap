<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Red Social</title>
		<link href="/css/normalize.css" rel="stylesheet" type="text/css" crossorigin="anonymous" />
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp"
			crossorigin="anonymous"
		/>
		<link href="/css/main.css" rel="stylesheet" type="text/css" crossorigin="anonymous" />
	</head>
	<body>
		<svg xmlns="http://www.w3.org/2000/svg" style="display: none">
			<symbol id="bootstrap" viewBox="0 0 118 94">
				<title>Bootstrap</title>
				<path
					fill-rule="evenodd"
					clip-rule="evenodd"
					d="M24.509 0c-6.733 0-11.715 5.893-11.492 12.284.214 6.14-.064 14.092-2.066 20.577C8.943 39.365 5.547 43.485 0 44.014v5.972c5.547.529 8.943 4.649 10.951 11.153 2.002 6.485 2.28 14.437 2.066 20.577C12.794 88.106 17.776 94 24.51 94H93.5c6.733 0 11.714-5.893 11.491-12.284-.214-6.14.064-14.092 2.066-20.577 2.009-6.504 5.396-10.624 10.943-11.153v-5.972c-5.547-.529-8.934-4.649-10.943-11.153-2.002-6.484-2.28-14.437-2.066-20.577C105.214 5.894 100.233 0 93.5 0H24.508zM80 57.863C80 66.663 73.436 72 62.543 72H44a2 2 0 01-2-2V24a2 2 0 012-2h18.437c9.083 0 15.044 4.92 15.044 12.474 0 5.302-4.01 10.049-9.119 10.88v.277C75.317 46.394 80 51.21 80 57.863zM60.521 28.34H49.948v14.934h8.905c6.884 0 10.68-2.772 10.68-7.727 0-4.643-3.264-7.207-9.012-7.207zM49.948 49.2v16.458H60.91c7.167 0 10.964-2.876 10.964-8.281 0-5.406-3.903-8.178-11.425-8.178H49.948z"
				></path>
			</symbol>
			<symbol id="home" viewBox="0 0 16 16">
				<path
					d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z"
				/>
			</symbol>
			<symbol id="speedometer2" viewBox="0 0 16 16">
				<path
					d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4zM3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.389.389 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.389.389 0 0 0-.029-.518z"
				/>
				<path
					fill-rule="evenodd"
					d="M0 10a8 8 0 1 1 15.547 2.661c-.442 1.253-1.845 1.602-2.932 1.25C11.309 13.488 9.475 13 8 13c-1.474 0-3.31.488-4.615.911-1.087.352-2.49.003-2.932-1.25A7.988 7.988 0 0 1 0 10zm8-7a7 7 0 0 0-6.603 9.329c.203.575.923.876 1.68.63C4.397 12.533 6.358 12 8 12s3.604.532 4.923.96c.757.245 1.477-.056 1.68-.631A7 7 0 0 0 8 3z"
				/>
			</symbol>
			<symbol id="table" viewBox="0 0 16 16">
				<path
					d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z"
				/>
			</symbol>
			<symbol id="people-circle" viewBox="0 0 16 16">
				<path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
				<path
					fill-rule="evenodd"
					d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"
				/>
			</symbol>
			<symbol id="grid" viewBox="0 0 16 16">
				<path
					d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"
				/>
			</symbol>
			<symbol id="notifications" viewBox="0 0 16 16">
				<path
					d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zm.995-14.901a1 1 0 1 0-1.99 0A5.002 5.002 0 0 0 3 6c0 1.098-.5 6-2 7h14c-1.5-1-2-5.902-2-7 0-2.42-1.72-4.44-4.005-4.901z"
				/>
			</symbol>
		</svg>

		<!-- MENÚ DE NAVEGACIÓN -->
		<%- include("./partials/header.ejs", {usuarioLogeado: usuario}); %>

		<!-- CONTENIDO PRINCIPAL -->
		<main class="main">
			<div class="row g-5">
				<!-- CONTENIDO LATERAL -->
				<aside class="col-12 col-md-4">
					<!-- USUARIOS RECOMENDADOS -->
					<div id="usuarios-recomendados" class="py-4 px-3 mb-4 rounded-3">
						<div class="container-fluid">
							<h2>A quién seguir</h2>
							<div class="d-flex flex-wrap justify-content-center justify-content-md-start gap-3 mt-4">
								<% if(usuariosRecomendados.length === 0) { %> Vaya, parece que hay poco movimiento. <% } else {
								for(let usuario of usuariosRecomendados) { %>
								<div class="d-flex flex-column align-items-center gap-1">
									<a href="/usuarios/<%= usuario.nombre %>">
										<img
											src="<%= usuario.signedUrlUsuario %>"
											alt="foto de perfil de <%= usuario.nombre %>"
											width="60"
											height="60"
											class="rounded-circle foto-perfil-nav"
											loading="lazy"
										/>
									</a>
									<a href="/usuarios/<%= usuario.nombre %>"><%= usuario.nombre %></a>
								</div>
								<% } } %>
							</div>
						</div>
					</div>
					<div class="p-5 mb-4 bg-body-tertiary rounded-3">
						<div class="container-fluid py-5">
							<h1 class="display-5 fw-bold">Custom jumbotron</h1>
							<p class="col-md-8 fs-4">
								Using a series of utilities, you can create this jumbotron, just like the one in previous versions
								of Bootstrap. Check out the examples below for how you can remix and restyle it to your liking.
							</p>
							<button class="btn btn-primary btn-lg" type="button">Example button</button>
						</div>
					</div>
				</aside>

				<div class="col-md-8">
					<div class="album py-5 bg-body-tertiary cont-timeline">
						<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#subirPostModal">
							+
						</button>

						<div
							class="modal fade"
							id="subirPostModal"
							tabindex="-1"
							aria-labelledby="subirPostModal"
							aria-hidden="true"
							data-bs-backdrop="static"
						>
							<div class="modal-dialog">
								<form
									action="/api/v1/posts"
									method="post"
									enctype="multipart/form-data"
									class="modal-content"
									id="form-subir-foto"
								>
									<div class="modal-header">
										<h1 class="modal-title fs-5" id="subirPostModalLabel">Subir post</h1>
										<button
											type="button"
											class="btn-close"
											data-bs-dismiss="modal"
											aria-label="Close"
										></button>
									</div>
									<div class="modal-body">
										<div class="mb-3">
											<label for="imagenASubir" class="col-form-label">Elige una imagen:</label>
											<input
												type="file"
												id="imagenASubir"
												name="imagenASubir"
												class="form-control"
												accept=".jpg, .jpeg, .png"
											/>
										</div>

										<div class="mb-3">
											<label for="texto" class="col-form-label">Escribe el pie de foto:</label>
											<textarea class="form-control" id="texto" name="texto" rows="4"></textarea>
										</div>
									</div>
									<div class="modal-footer">
										<input
											type="submit"
											class="btn btn-primary"
											id="btn-subir-img"
											name="btn-subir-img"
											value="Subir"
										/>
									</div>
								</form>
							</div>
						</div>

						<div id="timelines">
							<form action="" method="post" class="dropdown">
								<div class="dropdown">
									<button
										class="btn btn-primary dropdown-toggle"
										type="button"
										data-bs-toggle="dropdown"
										aria-expanded="false"
									>
										<%= usuario.tlElegido %>
									</button>
									<% if(usuario.tlElegido !== "Timeline") { %>
									<img class="conf-icon" src="images/gear-solid.svg" alt="Configurar timeline" />
									<% } %>
									<ul class="dropdown-menu">
										<% for(let tl of usuario.tls) { %> <% if(tl.nombre !== usuario.tlElegido) { %>
										<li>
											<a
												class="dropdown-item d-flex justify-content-between align-items-center"
												href="/<% if (tl.nombre !== 'Timeline') { %>?timeline=<%= tl.nombre %><% } %>"
											>
												<span><%= tl.nombre %></span> <% if(tl.nombre !== "Timeline") { %>
												<img class="conf-icon" src="images/gear-solid.svg" alt="Configurar timeline" /><%
												} %>
											</a>
										</li>
										<% } %> <% } %> <% if(usuario.tls.length > 1) { %>
										<li><hr class="dropdown-divider" /></li>
										<% } %>
										<li>
											<a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#tlsModal" href="#"
												>Nuevo Timeline</a
											>
										</li>
									</ul>
								</div>
							</form>
							<div
								class="modal fade"
								id="tlsModal"
								tabindex="-1"
								aria-labelledby="crearTLModal"
								aria-hidden="true"
								data-bs-backdrop="static"
							>
								<div class="modal-dialog">
									<form id="form-timeline" action="/api/v1/tls" method="POST" class="modal-content">
										<div class="modal-header">
											<h1 class="modal-title fs-5" id="crearTLModalLabel">Crear nuevo timeline</h1>
											<button
												type="button"
												class="btn-close"
												data-bs-dismiss="modal"
												aria-label="Close"
											></button>
										</div>
										<div class="modal-body">
											<div class="mb-3">
												<label for="nombreTl" class="col-form-label">Nombre:</label>
												<input
													type="text"
													class="form-control"
													id="nombreTl"
													name="nombreTl"
													data-value=""
												/>
											</div>
											<div class="row mb-3">
												<div class="column col-6">
													<label for="usuariosTl" class="col-form-label">Añadir usuarios:</label>
													<input type="text" class="form-control" name="usuariosTl[]" />
													<ul class="dropdown-menu text-small autocompletar-tl-ul"></ul>
												</div>
												<div class="column col-6">
													<label for="tagsTl" class="col-form-label">Añadir tags:</label>
													<input type="text" class="form-control" name="tagsTl[]" />
												</div>
											</div>
											<div class="mb-3">
												<label for="fechaTl" class="col-form-label">Fecha de subida:</label>
												<select class="form-select input-valido" id="fechaTl" name="fechaTl">
													<option value="dia" selected>Hoy</option>
													<option value="semana">Esta semana</option>
													<option value="mes">Este mes</option>
													<option value="smes">Desde hace 6 meses</option>
													<option value="elegir">Elegir fecha</option>
												</select>
											</div>
											<div class="row mb-3 ocultar" id="rango-fechas-tl">
												<div class="column col-6">
													<label for="desdeTl" class="col-form-label">Desde:</label>
													<input type="date" class="form-control" id="desdeTl" name="desdeTl" />
												</div>
												<div class="column col-6">
													<label for="hastaTl" class="col-form-label">Hasta:</label>
													<input type="date" class="form-control" id="hastaTl" name="hastaTl" />
												</div>
											</div>
											<div class="mb-3">
												<label for="ordenTl" class="col-form-label">Orden:</label>
												<select class="form-select input-valido" id="ordenTl" name="ordenTl">
													<option value="-fecha" selected>Más reciente</option>
													<option value="fecha">Más antiguo</option>
													<option value="-numFavs">Mayor número de favoritos</option>
													<option value="numFavs">Menor número de favoritos</option>
													<option value="-autor.id.numSeguidores">Mayor número de seguidores</option>
													<option value="autor.id.numSeguidores">Menor número de seguidores</option>
												</select>
											</div>
										</div>
										<div class="modal-footer">
											<input type="hidden" name="metodo" value="post" />
											<input type="hidden" name="anteriorNombre" value="Timeline" />
											<input type="submit" class="btn btn-primary" value="Crear" />
										</div>
									</form>
								</div>
							</div>
						</div>

						<div class="container">
							<div class="row row-cols-1 g-3">
								<% if(posts.length > 0) { %> <% for(let post of posts) { %> <%- include("./partials/post.ejs",
								{post: post}); %> <% } %> <% } else { %>
								<div class="col">Parece que todavía no hay nada aquí</div>
								<% } %>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
			crossorigin="anonymous"
		></script>
		<script src="/javascript/bootstrap.js" type="module" crossorigin="anonymous"></script>
		<script src="/javascript/menu.js" type="module" crossorigin="anonymous"></script>
		<script src="/javascript/index.js" type="module" crossorigin="anonymous"></script>
		<script src="/javascript/post.js" type="module" crossorigin="anonymous"></script>
	</body>
</html>
